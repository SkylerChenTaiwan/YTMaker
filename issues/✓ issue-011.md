# Issue-011: Flow-1 å½±ç‰‡ç”Ÿæˆæµç¨‹å®Œå…¨å¤±æ•—ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

> **å»ºç«‹æ—¥æœŸ:** 2025-10-23
> **å„ªå…ˆç´š:** ğŸ”´ P0 - å¿…é ˆç«‹å³ä¿®å¾©
> **ç‹€æ…‹:** â³ æœªè§£æ±º
> **ç™¼ç¾æ–¼:** Task-029E çœŸå¯¦ç’°å¢ƒæ¸¬è©¦

---

## å•é¡Œæè¿°

åœ¨ Task-029E çš„é›¶ Mock çœŸå¯¦ç’°å¢ƒæ¸¬è©¦ä¸­ï¼Œ**Flow-1: å½±ç‰‡ç”Ÿæˆæµç¨‹**æ¸¬è©¦å®Œå…¨å¤±æ•—ã€‚é€™æ˜¯ç³»çµ±çš„**æ ¸å¿ƒåŠŸèƒ½**ï¼Œå¦‚æœç„¡æ³•ç”Ÿæˆå½±ç‰‡ä¸¦ä¸Šå‚³åˆ° YouTubeï¼Œæ•´å€‹ç³»çµ±å°±å¤±å»å­˜åœ¨åƒ¹å€¼ã€‚

### å¤±æ•—çš„æ¸¬è©¦

**æ¸¬è©¦æ–‡ä»¶:** `tests/e2e/real/flow-1-video-generation.spec.ts`
**æ¸¬è©¦æ¡ˆä¾‹:** `æ‡‰è©²å®Œæ•´ç”Ÿæˆå½±ç‰‡ä¸¦ä¸Šå‚³åˆ° YouTube`
**åŸ·è¡Œæ™‚é–“:** 31.3ç§’å¾Œè¶…æ™‚å¤±æ•—

### å½±éŸ¿ç¯„åœ

- âŒ ç„¡æ³•ç”Ÿæˆå½±ç‰‡
- âŒ ç„¡æ³•ä¸Šå‚³åˆ° YouTube
- âŒ æ ¸å¿ƒæ¥­å‹™æµç¨‹ä¸­æ–·
- âš ï¸ ç³»çµ±ç„¡æ³•äº¤ä»˜åƒ¹å€¼çµ¦ç”¨æˆ¶

---

## é‡ç¾æ­¥é©Ÿ

1. å•Ÿå‹• backend å’Œ frontend
2. åŸ·è¡Œæ¸¬è©¦ï¼š
   ```bash
   cd /Users/skyler/coding/YTMaker-task-029E
   npx playwright test -c playwright.config.real.ts tests/e2e/real/flow-1-video-generation.spec.ts
   ```
3. è§€å¯Ÿæ¸¬è©¦åœ¨ 31.3 ç§’å¾Œå¤±æ•—

### æ¸¬è©¦æœŸæœ›çš„å®Œæ•´æµç¨‹

æ¸¬è©¦é æœŸåŸ·è¡Œä»¥ä¸‹ 14 å€‹æ­¥é©Ÿï¼š

1. âœ… å»ºç«‹æ–°å°ˆæ¡ˆ
2. âœ… è¼¸å…¥å°ˆæ¡ˆåç¨±
3. â“ ä¸Šå‚³æ–‡å­—å…§å®¹
4. â“ é…ç½®è¦–è¦ºå…ƒç´ 
5. â“ é¸æ“‡ Prompt ç¯„æœ¬
6. â“ é¸æ“‡ Gemini æ¨¡å‹
7. â“ è¨­å®š YouTube è³‡è¨Š
8. â“ é¸æ“‡ YouTube é »é“
9. â“ ç­‰å¾…è…³æœ¬ç”Ÿæˆï¼ˆçœŸå¯¦èª¿ç”¨ Gemini APIï¼‰
10. â“ ç­‰å¾…ç´ æç”Ÿæˆ
11. â“ ç­‰å¾…å½±ç‰‡æ¸²æŸ“ï¼ˆFFmpegï¼‰
12. â“ ç­‰å¾…å°é¢ç”Ÿæˆ
13. â“ ç­‰å¾… YouTube ä¸Šå‚³
14. â“ æŸ¥çœ‹çµæœ

**å•é¡Œï¼š** ä¸ç¢ºå®šåœ¨å“ªå€‹æ­¥é©Ÿå¤±æ•—ï¼Œéœ€è¦æŸ¥çœ‹è©³ç´° traceã€‚

---

## æ ¹æœ¬åŸå› åˆ†æ

### éœ€è¦èª¿æŸ¥çš„æ–¹å‘

1. **å‰ç«¯è·¯ç”±å•é¡Œ**
   - `/project/create` è·¯ç”±æ˜¯å¦å­˜åœ¨ï¼Ÿ
   - é é¢æ˜¯å¦æ­£ç¢ºè¼‰å…¥ï¼Ÿ

2. **å‰ç«¯è¡¨å–®å•é¡Œ**
   - è¡¨å–®å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Ÿ
   - å…ƒç´ çš„ name å±¬æ€§æ˜¯å¦æ­£ç¢ºï¼Ÿ
   - æª”æ¡ˆä¸Šå‚³åŠŸèƒ½æ˜¯å¦æ­£å¸¸ï¼Ÿ

3. **Backend API å•é¡Œ**
   - å°ˆæ¡ˆå»ºç«‹ API æ˜¯å¦æ­£å¸¸é‹ä½œï¼Ÿ
   - è…³æœ¬ç”Ÿæˆ API æ˜¯å¦æ­£å¸¸ï¼Ÿ
   - æ˜¯å¦æœ‰éŒ¯èª¤æ—¥èªŒï¼Ÿ

4. **å¤–éƒ¨ API æ•´åˆå•é¡Œ**
   - Gemini API æ˜¯å¦æ­£ç¢ºé…ç½®ï¼Ÿ
   - YouTube API æ˜¯å¦æ­£ç¢ºé…ç½®ï¼Ÿ

### æŸ¥çœ‹è©³ç´°éŒ¯èª¤

```bash
cd /Users/skyler/coding/YTMaker-task-029E

# æŸ¥çœ‹è©³ç´° traceï¼ˆåŒ…å«æ¯å€‹æ­¥é©Ÿçš„æˆªåœ–å’Œç¶²è·¯è«‹æ±‚ï¼‰
npx playwright show-trace test-results/flow-1-video-generation-*-chromium/trace.zip

# æŸ¥çœ‹å¤±æ•—æˆªåœ–
open test-results/flow-1-video-generation-*-chromium/test-failed-1.png

# æŸ¥çœ‹æ¸¬è©¦å½±ç‰‡
open test-results/flow-1-video-generation-*-chromium/video.webm
```

---

## è§£æ±ºæ–¹æ¡ˆ

### éšæ®µ 1: èª¿æŸ¥ï¼ˆ1-2 å°æ™‚ï¼‰

1. **æŸ¥çœ‹ Playwright trace**
   - æ‰¾å‡ºæ¸¬è©¦åœ¨å“ªå€‹æ­¥é©Ÿå¤±æ•—
   - æŸ¥çœ‹å¤±æ•—æ™‚çš„æˆªåœ–
   - æŸ¥çœ‹ç¶²è·¯è«‹æ±‚æ˜¯å¦æˆåŠŸ

2. **æª¢æŸ¥å‰ç«¯è·¯ç”±**
   ```bash
   # æ‰‹å‹•è¨ªå•æ¸¬è©¦è·¯ç”±
   open http://localhost:3000/project/create
   ```

3. **æª¢æŸ¥ backend æ—¥èªŒ**
   - æŸ¥çœ‹æ˜¯å¦æœ‰ API éŒ¯èª¤
   - ç¢ºèª Gemini API Key æ˜¯å¦æ­£ç¢º

### éšæ®µ 2: ä¿®å¾©ï¼ˆä¾èª¿æŸ¥çµæœè€Œå®šï¼‰

#### å¯èƒ½æƒ…æ³ A: å‰ç«¯è·¯ç”±ä¸å­˜åœ¨
```typescript
// frontend/src/app/project/create/page.tsx
export default function CreateProjectPage() {
  // å¯¦ä½œå°ˆæ¡ˆå»ºç«‹é é¢
}
```

#### å¯èƒ½æƒ…æ³ B: å‰ç«¯è¡¨å–®å…ƒç´ ä¸åŒ¹é…
- æ›´æ–°è¡¨å–®å…ƒç´ çš„ name å±¬æ€§
- æˆ–æ›´æ–°æ¸¬è©¦çš„é¸æ“‡å™¨

#### å¯èƒ½æƒ…æ³ C: Backend API æœªå¯¦ä½œ
- å¯¦ä½œ `/api/v1/projects` POST endpoint
- å¯¦ä½œè…³æœ¬ç”Ÿæˆ API
- å¯¦ä½œå½±ç‰‡ç”Ÿæˆ API

### éšæ®µ 3: é©—è­‰ä¿®å¾©

åŸ·è¡Œå®Œæ•´çš„é©—è­‰æµç¨‹ï¼ˆè¦‹ä¸‹æ–¹ã€Œé©—è­‰æ¸¬è©¦ã€ç« ç¯€ï¼‰ã€‚

---

## é©—è­‰æ¸¬è©¦

### ğŸ¯ æ¸¬è©¦ç›®æ¨™

ç¢ºèªä»¥ä¸‹åŠŸèƒ½å…¨éƒ¨æ­£å¸¸é‹ä½œï¼š
1. å¯ä»¥å»ºç«‹æ–°å°ˆæ¡ˆ
2. å¯ä»¥ä¸Šå‚³æ–‡å­—å…§å®¹
3. å¯ä»¥ç”Ÿæˆè…³æœ¬ï¼ˆçœŸå¯¦èª¿ç”¨ Gemini APIï¼‰
4. å¯ä»¥ç”Ÿæˆç´ æ
5. å¯ä»¥æ¸²æŸ“å½±ç‰‡
6. å¯ä»¥ä¸Šå‚³åˆ° YouTube
7. å¯ä»¥æŸ¥çœ‹çµæœ

### ğŸ“‹ é©—è­‰æ­¥é©Ÿ

#### 1. åŸ·è¡Œè‡ªå‹•åŒ–æ¸¬è©¦

```bash
cd /Users/skyler/coding/YTMaker-task-029E

# åŸ·è¡Œ Flow-1 æ¸¬è©¦
npx playwright test -c playwright.config.real.ts \
  tests/e2e/real/flow-1-video-generation.spec.ts \
  --reporter=list

# é æœŸçµæœï¼šâœ… 1 passed
```

#### 2. é©—è­‰è³‡æ–™åº«è¨˜éŒ„

æ¸¬è©¦é€šéå¾Œï¼Œé©—è­‰è³‡æ–™åº«æœ‰æ­£ç¢ºçš„è¨˜éŒ„ï¼š

```bash
sqlite3 backend/ytmaker.db <<EOF
-- æŸ¥çœ‹æœ€æ–°å»ºç«‹çš„å°ˆæ¡ˆ
SELECT
  id,
  name,
  status,
  youtube_video_id,
  created_at
FROM projects
WHERE name LIKE 'Test Project%'
ORDER BY created_at DESC
LIMIT 1;
EOF
```

**é æœŸçµæœï¼š**
- `status` = `'completed'`
- `youtube_video_id` ä¸ç‚º NULL

#### 3. é©—è­‰æª”æ¡ˆç”Ÿæˆ

```bash
# å–å¾—å°ˆæ¡ˆ IDï¼ˆå¾ä¸Šä¸€æ­¥çš„æŸ¥è©¢çµæœï¼‰
PROJECT_ID="<å¾è³‡æ–™åº«æŸ¥è©¢å¾—åˆ°çš„ ID>"

# é©—è­‰å½±ç‰‡æª”æ¡ˆå­˜åœ¨
ls -lh backend/data/projects/$PROJECT_ID/final_video.mp4

# é©—è­‰å°é¢æª”æ¡ˆå­˜åœ¨
ls -lh backend/data/projects/$PROJECT_ID/thumbnail.jpg

# é©—è­‰è…³æœ¬æª”æ¡ˆå­˜åœ¨
ls -lh backend/data/projects/$PROJECT_ID/script.json
```

**é æœŸçµæœï¼š**
- `final_video.mp4` å­˜åœ¨ä¸”å¤§å° > 1MB
- `thumbnail.jpg` å­˜åœ¨ä¸”å¤§å° > 10KB
- `script.json` å­˜åœ¨ä¸”åŒ…å«è…³æœ¬å…§å®¹

#### 4. é©—è­‰ YouTube ä¸Šå‚³

```bash
# å¾æ¸¬è©¦è¼¸å‡ºæˆ–è³‡æ–™åº«å–å¾— YouTube å½±ç‰‡ ID
YOUTUBE_VIDEO_ID="<å¾æ¸¬è©¦è¼¸å‡ºå–å¾—>"

# åœ¨ç€è¦½å™¨ä¸­é©—è­‰å½±ç‰‡å­˜åœ¨
open "https://youtube.com/watch?v=$YOUTUBE_VIDEO_ID"
```

**é æœŸçµæœï¼š**
- å½±ç‰‡å¯ä»¥åœ¨ YouTube ä¸Šæ’­æ”¾
- å½±ç‰‡æ¨™é¡Œã€æè¿°ã€æ¨™ç±¤æ­£ç¢º
- å½±ç‰‡éš±ç§è¨­å®šç‚º unlistedï¼ˆæ¸¬è©¦ç”¨ï¼‰

#### 5. æ‰‹å‹•æ¸¬è©¦ï¼ˆå¯é¸ï¼‰

å¦‚æœè‡ªå‹•åŒ–æ¸¬è©¦é€šéï¼Œé€²è¡Œä¸€æ¬¡æ‰‹å‹•æ¸¬è©¦é©—è­‰ï¼š

```bash
# 1. é–‹å•Ÿæ‡‰ç”¨
open http://localhost:3000

# 2. æ‰‹å‹•åŸ·è¡Œå®Œæ•´æµç¨‹
# - å»ºç«‹æ–°å°ˆæ¡ˆ
# - ä¸Šå‚³æ¸¬è©¦æ–‡å­—æª”æ¡ˆ
# - é…ç½®å„é …è¨­å®š
# - ç”Ÿæˆå½±ç‰‡
# - ç¢ºèªä¸Šå‚³æˆåŠŸ
```

### âœ… é€šéæ¨™æº–

**æ­¤ Issue è¢«è¦–ç‚ºå·²è§£æ±ºï¼Œç•¶ä¸”åƒ…ç•¶ï¼š**

1. âœ… **è‡ªå‹•åŒ–æ¸¬è©¦é€šé**
   ```
   npx playwright test tests/e2e/real/flow-1-video-generation.spec.ts

   çµæœ: âœ… 1 passed (é æœŸ 15-20 åˆ†é˜)
   ```

2. âœ… **è³‡æ–™åº«è¨˜éŒ„æ­£ç¢º**
   - å°ˆæ¡ˆç‹€æ…‹ = `completed`
   - æœ‰ YouTube video ID

3. âœ… **æª”æ¡ˆæ­£ç¢ºç”Ÿæˆ**
   - final_video.mp4 å­˜åœ¨ä¸” > 1MB
   - thumbnail.jpg å­˜åœ¨ä¸” > 10KB
   - script.json å­˜åœ¨ä¸”æœ‰æ•ˆ

4. âœ… **YouTube ä¸Šå‚³æˆåŠŸ**
   - å½±ç‰‡åœ¨ YouTube ä¸Šå¯æ’­æ”¾
   - å½±ç‰‡è³‡è¨Šæ­£ç¢º

5. âœ… **å¯é‡è¤‡åŸ·è¡Œ**
   - æ¸¬è©¦å¯ä»¥é‡è¤‡åŸ·è¡Œä¸¦é€šé
   - ä¸æœƒå› ç‚ºé‡è¤‡åŸ·è¡Œè€Œå¤±æ•—

### ğŸ“Š æ¸¬è©¦åŸ·è¡Œè¨˜éŒ„

| æ—¥æœŸ | åŸ·è¡Œè€… | çµæœ | å‚™è¨» |
|------|--------|------|------|
| 2025-10-23 | Claude | âŒ å¤±æ•— | åˆå§‹ç™¼ç¾ï¼Œ31.3ç§’è¶…æ™‚ |
| | | | |

---

## ç›¸é—œè³‡æº

### æ¸¬è©¦æ–‡ä»¶
- æ¸¬è©¦æª”æ¡ˆ: `tests/e2e/real/flow-1-video-generation.spec.ts`
- æ¸¬è©¦çµæœ: `test-results/flow-1-video-generation-*-chromium/`
- æ¸¬è©¦å ±å‘Š: `test-report-20251023-180621.md`

### ç›¸é—œ Spec
- `product-design/flows.md` - Flow-1 ç”¢å“æµç¨‹å®šç¾©
- `tech-specs/backend/api-projects.md` - å°ˆæ¡ˆ API è¦æ ¼
- `tech-specs/backend/api-script-generation.md` - è…³æœ¬ç”Ÿæˆ API
- `tech-specs/backend/api-video-generation.md` - å½±ç‰‡ç”Ÿæˆ API

### ç›¸é—œ Issues
- Issue-006: E2E æ¸¬è©¦å¤±æ•—ï¼ˆå·²è§£æ±ºï¼‰
- Issue-009: YouTube OAuth å•é¡Œï¼ˆå·²è§£æ±ºï¼‰

---

## æ™‚é–“ä¼°ç®—

- ğŸ” èª¿æŸ¥: 1-2 å°æ™‚
- ğŸ”§ ä¿®å¾©: 2-8 å°æ™‚ï¼ˆä¾å•é¡Œåš´é‡ç¨‹åº¦ï¼‰
- âœ… é©—è­‰: 30 åˆ†é˜
- **ç¸½è¨ˆ: 3.5-10.5 å°æ™‚**

---

## å‚™è¨»

é€™æ˜¯ **Task-029E ç™¼ç¾çš„æœ€é—œéµå•é¡Œ**ã€‚å¦‚æœæ ¸å¿ƒåŠŸèƒ½ç„¡æ³•é‹ä½œï¼Œç³»çµ±å°±ç„¡æ³•äº¤ä»˜åƒ¹å€¼ã€‚å»ºè­°åœ¨ä¿®å¾©å…¶ä»–å•é¡Œä¹‹å‰ï¼Œå„ªå…ˆè§£æ±ºæ­¤å•é¡Œã€‚

ä¿®å¾©å®Œæˆå¾Œï¼Œå»ºè­°åŸ·è¡Œå®Œæ•´çš„æ¸¬è©¦å¥—ä»¶ï¼Œç¢ºä¿ä¿®å¾©æ²’æœ‰ç ´å£å…¶ä»–åŠŸèƒ½ï¼š

```bash
npx playwright test -c playwright.config.real.ts
```
